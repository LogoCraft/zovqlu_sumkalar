<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Dream</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Özel Kaydırma Çubuğu */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .bookmark-highlight {
            box-shadow: 0 0 15px 5px rgba(250, 204, 21, 0.7); /* yellow-400 */
            border: 2px solid #FACC15; /* yellow-400 */
        }
        /* Sınav Seçenekleri için özel stil */
        .quiz-option {
            display: block;
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #4B5563; /* gray-600 */
            background-color: #374151; /* gray-700 */
            border-radius: 8px;
            color: #E5E7EB; /* gray-200 */
            font-medium: 500;
            text-align: left;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .quiz-option:hover {
            background-color: #4B5563; /* gray-600 */
            border-color: #A78BFA; /* purple-400 */
        }
        .quiz-option.correct {
            background-color: #10B981; /* green-500 */
            border-color: #059669; /* green-600 */
            color: #FFFFFF;
        }
        .quiz-option.incorrect {
            background-color: #EF4444; /* red-500 */
            border-color: #DC2626; /* red-600 */
            color: #FFFFFF;
        }
        .quiz-option:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-gray-900 min-h-screen text-gray-200">

    <!-- Header -->
    <header class="bg-gray-800 shadow-md sticky top-0 z-50">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <h1 class="text-2xl sm:text-3xl font-bold text-purple-400">English Dream</h1>
                <div class="flex items-center space-x-2 sm:space-x-4">
                    <!-- Kelime Arama -->
                    <div class="hidden md:flex items-center bg-gray-700 rounded-full">
                        <input id="search-bar" type="text" placeholder="Kelime Ara veya Cümle Çevir..." class="bg-transparent text-white placeholder-gray-400 rounded-l-full py-2 px-4 focus:outline-none w-48">
                        <button id="search-btn" class="p-2 text-gray-400 hover:text-purple-400">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        </button>
                    </div>

                    <button id="exam-history-btn" class="p-2 rounded-full text-gray-300 hover:bg-gray-700 hover:text-purple-400 transition" title="Sınav Geçmişi">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.882a2 2 0 01-2 2H7a2 2 0 01-2-2V5.882a2 2 0 012-2h2a2 2 0 012 2zM17 5.882V19.882a2 2 0 002 2h2a2 2 0 002-2V5.882a2 2 0 00-2-2h-2a2 2 0 00-2 2zM6 19v-5H4V9h2m12 10v-5h2V9h-2M12 2v2M9 4h6"></path><path d="M12 4C9.23858 4 7 6.23858 7 9v1h10V9c0-2.76142-2.23858-5-5-5z"></path></svg>
                    </button>
                    <button id="pinned-list-btn" class="p-2 rounded-full text-gray-300 hover:bg-gray-700 hover:text-purple-400 transition" title="Sabitlenen Kelimeler">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 10-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg>
                    </button>
                    <span id="level-selection" class="hidden sm:flex items-center space-x-1">
                        <button data-level="a1" class="level-btn px-3 py-2 rounded-md text-sm font-medium transition bg-purple-600 text-white">A1</button>
                        <button data-level="a2" class="level-btn px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700 transition">A2</button>
                        <button data-level="b1" class="level-btn px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700 transition">B1</button>
                        <button data-level="b2" class="level-btn px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700 transition">B2</button>
                        <button data-level="c1" class="level-btn px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700 transition">C1</button>
                    </span>
                </div>
            </div>
            <!-- Mobil Seviye Seçimi -->
            <div id="mobile-level-selection" class="sm:hidden flex justify-center space-x-2 pb-3 border-t border-gray-700 pt-3">
                <button data-level="a1" class="level-btn px-3 py-2 rounded-md text-sm font-medium transition bg-purple-600 text-white">A1</button>
                <button data-level="a2" class="level-btn px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700 transition">A2</button>
                <button data-level="b1" class="level-btn px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700 transition">B1</button>
                <button data-level="b2" class="level-btn px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700 transition">B2</button>
                <button data-level="c1" class="level-btn px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700 transition">C1</button>
            </div>
            <!-- Mobil Arama -->
            <div class="md:hidden flex items-center bg-gray-700 rounded-full mx-4 mb-3">
                <input id="mobile-search-bar" type="text" placeholder="Kelime Ara veya Cümle Çevir..." class="bg-transparent text-white placeholder-gray-400 rounded-l-full py-2 px-4 focus:outline-none w-full">
                <button id="mobile-search-btn" class="p-2 text-gray-400 hover:text-purple-400">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </button>
            </div>
        </nav>
    </header>

    <!-- Ana İçerik Alanı -->
    <main id="main-content" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">

        <!-- Kontrol Butonları -->
        <div class="mb-6 flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
            <button id="refresh-btn" class="flex-1 w-full bg-purple-600 text-white px-5 py-3 rounded-lg font-semibold shadow-md hover:bg-purple-700 transition flex items-center justify-center space-x-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9H0v5h.582A8.001 8.001 0 0023.418 15H24v-5h-.582z"></path></svg>
                <span>Yeni Kelimeler Getir (50)</span>
            </button>
            <button id="toggle-freeze-btn" class="flex-1 w-full bg-green-600 text-white px-5 py-3 rounded-lg font-semibold shadow-md hover:bg-green-700 transition">
                Listeyi Sabitle
            </button>
            <button id="start-quiz-btn" class="flex-1 w-full bg-purple-600 text-white px-5 py-3 rounded-lg font-semibold shadow-md hover:bg-purple-700 transition disabled:bg-gray-500 disabled:cursor-not-allowed">
                Sınava Başla (15 Soru)
            </button>
        </div>

        <!-- Kelime Listesi -->
        <div id="word-list-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
            <!-- Kelime Kartları buraya eklenecek -->
        </div>

        <!-- Yükleniyor... -->
        <div id="loading-spinner" class="text-center py-10 hidden">
            <svg class="animate-spin h-8 w-8 text-purple-400 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-2 text-gray-400 font-medium">Kelimeler yükleniyor...</p>
        </div>
    </main>

    <!-- Sınav Arayüzü (Başlangıçta gizli) -->
    <div id="quiz-container" class="hidden max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        <div class="bg-gray-800 p-6 sm:p-8 rounded-lg shadow-xl max-w-3xl mx-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-100">İngilizce Sınavı</h2>
                <div class="flex items-center">
                    <span id="quiz-progress" class="text-gray-300">Soru 1 / 15</span>
                    <span id="quiz-score" class="ml-4 text-green-400">Puan: 0</span>
                    <button id="request-exit-quiz-btn" class="ml-4 text-sm bg-red-600 text-white px-3 py-1 rounded-md hover:bg-red-700 transition" title="Sınavdan Çık">Çık</button>
                </div>
            </div>
            <div id="question-area">
                <p id="question-text" class="text-xl text-gray-200 mb-6 font-medium">Soru metni buraya gelecek.</p>
                <div id="options-container" class="space-y-3">
                    <!-- Seçenekler (çoktan seçmeli VEYA input) buraya eklenecek -->
                </div>
                <div id="quiz-feedback" class="mt-4 text-center font-medium hidden"></div>
            </div>
            <div id="quiz-results" class="hidden text-center">
                <h3 class="text-3xl font-bold text-purple-400 mb-4">Sınav Tamamlandı!</h3>
                <p class="text-2xl text-gray-200 mb-8">Puanınız: <span id="final-score" class="font-bold"></span> / 15</p>
                <div class="flex justify-center space-x-4">
                    <button id="restart-quiz-btn" class="bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-700 transition">
                        Yeniden Başla
                    </button>
                    <button id="exit-quiz-btn" class="bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-gray-700 transition">
                        Kelimelere Dön
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- Sabitlenen Kelimeler Modalı -->
    <div id="pinned-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 rounded-lg shadow-xl w-11/12 max-w-2xl h-4/5 flex flex-col">
            <div class="flex justify-between items-center p-5 border-b border-gray-700">
                <h3 class="text-2xl font-semibold text-gray-100">Sabitlenen Kelimeler</h3>
                <button id="close-pinned-modal-btn" class="text-gray-400 hover:text-white">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div id="pinned-list-content" class="p-6 overflow-y-auto">
                <!-- Sabitlenen kelimeler buraya eklenecek -->
            </div>
        </div>
    </div>

    <!-- Sınav Geçmişi Modalı -->
    <div id="exam-history-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 rounded-lg shadow-xl w-11/12 max-w-2xl h-4/5 flex flex-col">
            <div class="flex justify-between items-center p-5 border-b border-gray-700">
                <h3 class="text-2xl font-semibold text-gray-100">Sınav Geçmişi</h3>
                <button id="close-exam-history-modal-btn" class="text-gray-400 hover:text-white">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div id="exam-history-content" class="p-6 overflow-y-auto flex-grow">
                <!-- Sınav geçmişi buraya eklenecek -->
            </div>
            <div class="p-4 border-t border-gray-700">
                <button id="clear-exam-history-btn" class="w-full bg-red-600 text-white px-5 py-3 rounded-lg font-semibold shadow-md hover:bg-red-700 transition">
                    Geçmişi Temizle
                </button>
            </div>
        </div>
    </div>

    <!-- Arama Sonuçları Modalı -->
    <div id="search-results-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 rounded-lg shadow-xl w-11/12 max-w-2xl h-4/5 flex flex-col">
            <div class="flex justify-between items-center p-5 border-b border-gray-700">
                <h3 class="text-2xl font-semibold text-gray-100">Arama / Çeviri Sonuçları</h3>
                <button id="close-search-results-modal-btn" class="text-gray-400 hover:text-white">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div id="search-results-content" class="p-6 overflow-y-auto">
                <!-- Arama sonuçları buraya eklenecek -->
            </div>
        </div>
    </div>

    <!-- Sınavdan Çıkış Onay Modalı -->
    <div id="exit-quiz-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 rounded-lg shadow-xl w-11/12 max-w-md p-6">
            <h3 class="text-xl font-semibold text-white mb-4">Sınavdan Çıkmak Üzeresiniz</h3>
            <p class="text-gray-300 mb-6">Sınavdan şimdi çıkarsanız mevcut ilerlemeniz sıfırlanacaktır. Emin misiniz?</p>
            <div class="flex justify-end space-x-4">
                <button id="cancel-exit-quiz-btn" class="px-5 py-2 rounded-lg bg-gray-600 text-white font-medium hover:bg-gray-500 transition">
                    İptal
                </button>
                <button id="confirm-exit-quiz-btn" class="px-5 py-2 rounded-lg bg-red-600 text-white font-medium hover:bg-red-700 transition">
                    Evet, Çık
                </button>
            </div>
        </div>
    </div>

    <!-- Özel Mesaj Kutusu -->
    <div id="app-message" class="fixed bottom-5 right-5 bg-red-600 text-white px-6 py-4 rounded-lg shadow-xl z-50 hidden transition-all duration-300 transform translate-y-20 opacity-0">
        <span id="app-message-text">Bu bir hata mesajıdır.</span>
    </div>

    <script>
        // --- KELİME VERİTABANI (ÖRNEK) ---
        // Gerçek bir uygulamada bu veritabanı çok daha büyük olurdu ve bir sunucudan gelirdi.
        const wordBank = {
            a1: [
                { en: 'Hello', tr: 'Merhaba', en_sentence: 'Hello, how are you?', tr_sentence: 'Merhaba, nasılsın?' },
                { en: 'Goodbye', tr: 'Güle güle', en_sentence: 'Goodbye, see you tomorrow.', tr_sentence: 'Güle güle, yarın görüşürüz.' },
                { en: 'Cat', tr: 'Kedi', en_sentence: 'The cat is sleeping.', tr_sentence: 'Kedi uyuyor.' },
                { en: 'Dog', tr: 'Köpek', en_sentence: 'I have a small dog.', tr_sentence: 'Küçük bir köpeğim var.' },
                { en: 'Book', tr: 'Kitap', en_sentence: 'Please read this book.', tr_sentence: 'Lütfen bu kitabı oku.' },
                { en: 'Water', tr: 'Su', en_sentence: 'Can I have some water?', tr_sentence: 'Biraz su alabilir miyim?' },
                { en: 'Apple', tr: 'Elma', en_sentence: 'She is eating an apple.', tr_sentence: 'O, bir elma yiyor.' },
                { en: 'House', tr: 'Ev', en_sentence: 'My house is big.', tr_sentence: 'Evim büyük.' },
                { en: 'Car', tr: 'Araba', en_sentence: 'He has a red car.', tr_sentence: 'Onun kırmızı bir arabası var.' },
                { en: 'Man', tr: 'Adam', en_sentence: 'The man is tall.', tr_sentence: 'Adam uzun boylu.' },
                { en: 'Woman', tr: 'Kadın', en_sentence: 'The woman is reading.', tr_sentence: 'Kadın okuyor.' },
                { en: 'Child', tr: 'Çocuk', en_sentence: 'The child is playing.', tr_sentence: 'Çocuk oynuyor.' },
                { en: 'Time', tr: 'Zaman', en_sentence: 'What time is it?', tr_sentence: 'Saat kaç?' },
                { en: 'Money', tr: 'Para', en_sentence: 'I need more money.', tr_sentence: 'Daha fazla paraya ihtiyacım var.' },
                { en: 'School', tr: 'Okul', en_sentence: 'They go to school.', tr_sentence: 'Onlar okula gider.' },
                { en: 'Food', tr: 'Yiyecek', en_sentence: 'This food is delicious.', tr_sentence: 'Bu yiyecek lezzetli.' },
                { en: 'Friend', tr: 'Arkadaş', en_sentence: 'He is my best friend.', tr_sentence: 'O benim en iyi arkadaşım.' },
                { en: 'Today', tr: 'Bugün', en_sentence: 'Today is Monday.', tr_sentence: 'Bugün Pazartesi.' },
                { en: 'Morning', tr: 'Sabah', en_sentence: 'Good morning!', tr_sentence: 'Günaydın!' },
                { en: 'Night', tr: 'Gece', en_sentence: 'Good night!', tr_sentence: 'İyi geceler!' },
                { en: 'Red', tr: 'Kırmızı', en_sentence: 'I like the color red.', tr_sentence: 'Kırmızı rengi severim.' },
                { en: 'Blue', tr: 'Mavi', en_sentence: 'The sky is blue.', tr_sentence: 'Gökyüzü mavidir.' },
                { en: 'Green', tr: 'Yeşil', en_sentence: 'The grass is green.', tr_sentence: 'Çimen yeşildir.' },
                { en: 'Big', tr: 'Büyük', en_sentence: 'It is a big city.', tr_sentence: 'O büyük bir şehir.' },
                { en: 'Small', tr: 'Küçük', en_sentence: 'I have a small problem.', tr_sentence: 'Küçük bir problemim var.' },
                { en: 'Good', tr: 'İyi', en_sentence: 'This is a good movie.', tr_sentence: 'Bu iyi bir film.' },
                { en: 'Bad', tr: 'Kötü', en_sentence: 'The weather is bad.', tr_sentence: 'Hava kötü.' },
                { en: 'Happy', tr: 'Mutlu', en_sentence: 'I am very happy.', tr_sentence: 'Çok mutluyum.' },
                { en: 'Sad', tr: 'Üzgün', en_sentence: 'Why are you sad?', tr_sentence: 'Neden üzgünsün?' },
                { en: 'Eat', tr: 'Yemek', en_sentence: 'I want to eat pizza.', tr_sentence: 'Pizza yemek istiyorum.' },
                { en: 'Drink', tr: 'İçmek', en_sentence: 'He drinks coffee.', tr_sentence: 'O, kahve içer.' },
                { en: 'Go', tr: 'Gitmek', en_sentence: 'Let\'s go to the park.', tr_sentence: 'Hadi parka gidelim.' },
                { en: 'See', tr: 'Görmek', en_sentence: 'I can see the moon.', tr_sentence: 'Ay\'ı görebiliyorum.' },
                { en: 'Run', tr: 'Koşmak', en_sentence: 'The dog can run fast.', tr_sentence: 'Köpek hızlı koşabilir.' },
                { en: 'Walk', tr: 'Yürümek', en_sentence: 'I walk to school.', tr_sentence: 'Okula yürüyerek giderim.' },
                { en: 'Read', tr: 'Okumak', en_sentence: 'She likes to read books.', tr_sentence: 'O, kitap okumayı sever.' },
                { en: 'Write', tr: 'Yazmak', en_sentence: 'Write your name here.', tr_sentence: 'Adını buraya yaz.' },
                { en: 'Help', tr: 'Yardım', en_sentence: 'Can you help me?', tr_sentence: 'Bana yardım edebilir misin?' },
                { en: 'Love', tr: 'Sevmek', en_sentence: 'I love my family.', tr_sentence: 'Ailemi seviyorum.' },
                { en: 'Work', tr: 'Çalışmak', en_sentence: 'My father works hard.', tr_sentence: 'Babam çok çalışır.' },
                { en: 'Play', tr: 'Oynamak', en_sentence: 'Children love to play.', tr_sentence: 'Çocuklar oynamayı sever.' },
                { en: 'Sleep', tr: 'Uyumak', en_sentence: 'The baby is sleeping.', tr_sentence: 'Bebek uyuyor.' },
                { en: 'Old', tr: 'Eski', en_sentence: 'This is an old house.', tr_sentence: 'Bu eski bir ev.' },
                { en: 'New', tr: 'Yeni', en_sentence: 'I bought a new phone.', tr_sentence: 'Yeni bir telefon aldım.' },
                { en: 'Cold', tr: 'Soğuk', en_sentence: 'The weather is cold.', tr_sentence: 'Hava soğuk.' },
                { en: 'Hot', tr: 'Sıcak', en_sentence: 'The coffee is hot.', tr_sentence: 'Kahve sıcak.' },
                { en: 'Easy', tr: 'Kolay', en_sentence: 'The test was easy.', tr_sentence: 'Test kolaydı.' },
                { en: 'Hard', tr: 'Zor', en_sentence: 'This is a hard question.', tr_sentence: 'Bu zor bir soru.' },
                { en: 'Yes', tr: 'Evet', en_sentence: 'Yes, I understand.', tr_sentence: 'Evet, anlıyorum.' },
                { en: 'No', tr: 'Hayır', en_sentence: 'No, thank you.', tr_sentence: 'Hayır, teşekkürler.' },
                { en: 'Thank you', tr: 'Teşekkürler', en_sentence: 'Thank you for your help.', tr_sentence: 'Yardımın için teşekkürler.' },
                { en: 'Please', tr: 'Lütfen', en_sentence: 'Please sit down.', tr_sentence: 'Lütfen otur.' },
                { en: 'Family', tr: 'Aile', en_sentence: 'I have a big family.', tr_sentence: 'Büyük bir ailem var.' },
                { en: 'Mother', tr: 'Anne', en_sentence: 'My mother is a doctor.', tr_sentence: 'Annem bir doktor.' },
                { en: 'Father', tr: 'Baba', en_sentence: 'My father is tall.', tr_sentence: 'Babam uzundur.' },
                { en: 'Sister', tr: 'Kız kardeş', en_sentence: 'I have one sister.', tr_sentence: 'Bir kız kardeşim var.' },
                { en: 'Brother', tr: 'Erkek kardeş', en_sentence: 'My brother is young.', tr_sentence: 'Erkek kardeşim genç.' },
                { en: 'Sun', tr: 'Güneş', en_sentence: 'The sun is shining.', tr_sentence: 'Güneş parlıyor.' },
                { en: 'Moon', tr: 'Ay', en_sentence: 'The moon is bright.', tr_sentence: 'Ay parlak.' },
                { en: 'Tree', tr: 'Ağaç', en_sentence: 'That is a big tree.', tr_sentence: 'O büyük bir ağaç.' },
            ],
            a2: [
                { en: 'Kitchen', tr: 'Mutfak', en_sentence: 'We cook in the kitchen.', tr_sentence: 'Mutfakta yemek yaparız.' },
                { en: 'Library', tr: 'Kütüphane', en_sentence: 'I borrow books from the library.', tr_sentence: 'Kütüphaneden kitap ödünç alırım.' },
                { en: 'Restaurant', tr: 'Restoran', en_sentence: 'Let\'s eat at a restaurant.', tr_sentence: 'Hadi bir restoranda yiyelim.' },
                { en: 'Hospital', tr: 'Hastane', en_sentence: 'The doctor works at the hospital.', tr_sentence: 'Doktor hastanede çalışır.' },
                { en: 'Weather', tr: 'Hava durumu', en_sentence: 'How is the weather today?', tr_sentence: 'Bugün hava nasıl?' },
                { en: 'Computer', tr: 'Bilgisayar', en_sentence: 'I use my computer every day.', tr_sentence: 'Bilgisayarımı her gün kullanırım.' },
                { en: 'Music', tr: 'Müzik', en_sentence: 'She loves listening to music.', tr_sentence: 'O, müzik dinlemeyi sever.' },
                { en: 'Movie', tr: 'Film', en_sentence: 'We watched a movie last night.', tr_sentence: 'Dün gece bir film izledik.' },
                { en: 'Morning', tr: 'Sabah', en_sentence: 'I wake up early in the morning.', tr_sentence: 'Sabahları erken kalkarım.' },
                { en: 'Evening', tr: 'Akşam', en_sentence: 'We will meet in the evening.', tr_sentence: 'Akşam buluşacağız.' },
                { en: 'Telephone', tr: 'Telefon', en_sentence: 'The telephone is ringing.', tr_sentence: 'Telefon çalıyor.' },
                { en: 'Beautiful', tr: 'Güzel', en_sentence: 'This flower is beautiful.', tr_sentence: 'Bu çiçek güzel.' },
                { en: 'Difficult', tr: 'Zor', en_sentence: 'This homework is difficult.', tr_sentence: 'Bu ev ödevi zor.' },
                { en: 'Interesting', tr: 'İlginç', en_sentence: 'It is an interesting story.', tr_sentence: 'Bu ilginç bir hikaye.' },
                { en: 'Expensive', tr: 'Pahalı', en_sentence: 'This car is very expensive.', tr_sentence: 'Bu araba çok pahalı.' },
                { en: 'Cheap', tr: 'Ucuz', en_sentence: 'I found a cheap ticket.', tr_sentence: 'Ucuz bir bilet buldum.' },
                { en: 'Always', tr: 'Her zaman', en_sentence: 'He is always late.', tr_sentence: 'O her zaman geç kalır.' },
                { en: 'Usually', tr: 'Genellikle', en_sentence: 'I usually drink tea.', tr_sentence: 'Genellikle çay içerim.' },
                { en: 'Sometimes', tr: 'Bazen', en_sentence: 'Sometimes I go to the cinema.', tr_sentence: 'Bazen sinemaya giderim.' },
                { en: 'Never', tr: 'Asla', en_sentence: 'I never eat meat.', tr_sentence: 'Asla et yemem.' },
                { en: 'Travel', tr: 'Seyahat etmek', en_sentence: 'I like to travel.', tr_sentence: 'Seyahat etmeyi severim.' },
                { en: 'Study', tr: 'Ders çalışmak', en_sentence: 'You need to study hard.', tr_sentence: 'Çok ders çalışman gerek.' },
                { en: 'Listen', tr: 'Dinlemek', en_sentence: 'Please listen to me.', tr_sentence: 'Lütfen beni dinle.' },
                { en: 'Speak', tr: 'Konuşmak', en_sentence: 'Can you speak English?', tr_sentence: 'İngilizce konuşabiliyor musun?' },
                { en: 'Understand', tr: 'Anlamak', en_sentence: 'I don\'t understand this word.', tr_sentence: 'Bu kelimeyi anlamıyorum.' },
                { en: 'Forget', tr: 'Unutmak', en_sentence: 'Don\'t forget your keys.', tr_sentence: 'Anahtarlarını unutma.' },
                { en: 'Remember', tr: 'Hatırlamak', en_sentence: 'I remember his name.', tr_sentence: 'Onun adını hatırlıyorum.' },
                { en: 'Holiday', tr: 'Tatil', en_sentence: 'We are on holiday.', tr_sentence: 'Tatildeyiz.' },
                { en: 'Beach', tr: 'Plaj', en_sentence: 'Let\'s go to the beach.', tr_sentence: 'Hadi plaja gidelim.' },
                { en: 'Mountain', tr: 'Dağ', en_sentence: 'The mountain is high.', tr_sentence: 'Dağ yüksek.' },
            ],
            b1: [
                { en: 'Environment', tr: 'Çevre', en_sentence: 'We must protect the environment.', tr_sentence: 'Çevreyi korumalıyız.' },
                { en: 'Opportunity', tr: 'Fırsat', en_sentence: 'This is a great opportunity.', tr_sentence: 'Bu harika bir fırsat.' },
                { en: 'Government', tr: 'Hükümet', en_sentence: 'The government made a new law.', tr_sentence: 'Hükümet yeni bir yasa çıkardı.' },
                { en: 'Confidence', tr: 'Özgüven', en_sentence: 'He lacks confidence.', tr_sentence: 'Onun özgüveni eksik.' },
                { en: 'Conversation', tr: 'Sohbet', en_sentence: 'We had a long conversation.', tr_sentence: 'Uzun bir sohbet ettik.' },
                { en: 'Development', tr: 'Gelişim', en_sentence: 'Personal development is important.', tr_sentence: 'Kişisel gelişim önemlidir.' },
                { en: 'Education', tr: 'Eğitim', en_sentence: 'Education is the key to success.', tr_sentence: 'Eğitim, başarının anahtarıdır.' },
                { en: 'Experience', tr: 'Deneyim', en_sentence: 'I have 5 years of experience.', tr_sentence: '5 yıllık deneyimim var.' },
                { en: 'Relationship', tr: 'İlişki', en_sentence: 'They have a strong relationship.', tr_sentence: 'Onların güçlü bir ilişkisi var.' },
                { en: 'Responsible', tr: 'Sorumlu', en_sentence: 'You are responsible for this.', tr_sentence: 'Bundan sen sorumlusun.' },
                { en: 'Suggestion', tr: 'Öneri', en_sentence: 'Do you have any suggestions?', tr_sentence: 'Herhangi bir önerin var mı?' },
                { en: 'Knowledge', tr: 'Bilgi', en_sentence: 'Knowledge is power.', tr_sentence: 'Bilgi güçtür.' },
                { en: 'Improve', tr: 'Geliştirmek', en_sentence: 'I want to improve my English.', tr_sentence: 'İngilizcemi geliştirmek istiyorum.' },
                { en: 'Achieve', tr: 'Başarmak', en_sentence: 'You can achieve your goals.', tr_sentence: 'Hedeflerine ulaşabilirsin.' },
                { en: 'However', tr: 'Ancak', en_sentence: 'He is rich. However, he is not happy.', tr_sentence: 'O zengin. Ancak, mutlu değil.' },
                { en: 'Therefore', tr: 'Bu yüzden', en_sentence: 'She was late. Therefore, she missed the bus.', tr_sentence: 'Geç kalmıştı. Bu yüzden otobüsü kaçırdı.' },
            ],
            b2: [
                { en: 'Consequence', tr: 'Sonuç', en_sentence: 'Every action has a consequence.', tr_sentence: 'Her eylemin bir sonucu vardır.' },
                { en: 'Significant', tr: 'Önemli', en_sentence: 'There is a significant difference.', tr_sentence: 'Önemli bir fark var.' },
                { en: 'Furthermore', tr: 'Ayrıca', en_sentence: 'He is smart. Furthermore, he is kind.', tr_sentence: 'O zeki. Ayrıca, nazik.' },
                { en: 'Nevertheless', tr: 'Yine de', en_sentence: 'It was raining. Nevertheless, we went out.', tr_sentence: 'Yağmur yağıyordu. Yine de dışarı çıktık.' },
                { en: 'Controversial', tr: 'Tartışmalı', en_sentence: 'It is a controversial topic.', tr_sentence: 'Bu tartışmalı bir konu.' },
                { en: 'Sophisticated', tr: 'Sofistike', en_sentence: 'She has a sophisticated style.', tr_sentence: 'Onun sofistike bir tarzı var.' },
                { en: 'Influence', tr: 'Etkilemek', en_sentence: 'His speech influenced many people.', tr_sentence: 'Onun konuşması birçok insanı etkiledi.' },
                { en: 'In-depth', tr: 'Derinlemesine', en_sentence: 'We need an in-depth analysis.', tr_sentence: 'Derinlemesine bir analize ihtiyacımız var.' },
                { en: 'Negotiate', tr: 'Müzakere etmek', en_sentence: 'They will negotiate the contract.', tr_sentence: 'Sözleşmeyi müzakere edecekler.' },
                { en: 'Apparently', tr: 'Görünüşe göre', en_sentence: 'Apparently, he is not coming.', tr_sentence: 'Görünüşe göre o gelmiyor.' },
                { en: 'Ubiquitous', tr: 'Her yerde bulunan', en_sentence: 'The internet is ubiquitous.', tr_sentence: 'İnternet her yerde bulunur.' },
                { en: 'Alleviate', tr: 'Hafifletmek', en_sentence: 'This medicine will alleviate the pain.', tr_sentence: 'Bu ilaç ağrıyı hafifletecek.' },
                { en: 'Meticulous', tr: 'Titiz', en_sentence: 'She is meticulous in her work.', tr_sentence: 'İşinde çok titizdir.' },
                { en: 'Exacerbate', tr: 'Şiddetlendirmek', en_sentence: 'His comments exacerbated the situation.', tr_sentence: 'Onun yorumları durumu şiddetlendirdi.' },
                { en: 'Resilient', tr: 'Dirençli', en_sentence: 'Children are often very resilient.', tr_sentence: 'Çocuklar genellikle çok dirençlidir.' },
                { en: 'Ambiguous', tr: 'Belirsiz', en_sentence: 'The instructions were ambiguous.', tr_sentence: 'Talimatlar belirsizdi.' },
                { en: 'Consensus', tr: 'Fikir birliği', en_sentence: 'The committee reached a consensus.', tr_sentence: 'Komite bir fikir birliğine vardı.' },
                { en: 'Prerequisite', tr: 'Ön koşul', en_sentence: 'This course is a prerequisite for the next one.', tr_sentence: 'Bu ders bir sonraki için ön koşuldur.' },
                { en: 'Superficial', tr: 'Yüzeysel', en_sentence: 'It was a superficial analysis.', tr_sentence: 'Bu yüzeysel bir analisti.' },
                { en: 'Tentative', tr: 'Geçici', en_sentence: 'We have a tentative agreement.', tr_sentence: 'Geçici bir anlaşmamız var.' },
                { en: 'Discrepancy', tr: 'Tutarsızlık', en_sentence: 'There is a discrepancy in the accounts.', tr_sentence: 'Hesaplarda bir tutarsızlık var.' },
                { en: 'Comprehensive', tr: 'Kapsamlı', en_sentence: 'He has a comprehensive knowledge of the subject.', tr_sentence: 'Konu hakkında kapsamlı bir bilgisi var.' },
                { en: 'Lucrative', tr: 'Kazançlı', en_sentence: 'He found a lucrative business.', tr_sentence: 'Kazançlı bir iş buldu.' },
                { en: 'Mitigate', tr: 'Azaltmak', en_sentence: 'We need to mitigate the risks.', tr_sentence: 'Riskleri azaltmamız gerekiyor.' },
                { en: 'Plethora', tr: 'Fazlalık', en_sentence: 'There is a plethora of options.', tr_sentence: 'Bir sürü seçenek fazlalığı var.' },
                { en: 'To keep an eye on', tr: 'Göz kulak olmak', en_sentence: 'Can you keep an eye on my bag?', tr_sentence: 'Çantama göz kulak olabilir misin?' },
                { en: 'As a matter of fact', tr: 'Aslına bakarsan', en_sentence: 'As a matter of fact, I was just leaving.', tr_sentence: 'Aslına bakarsan, tam da gidiyordum.' }
            ],
            c1: [
                { en: 'Aberration', tr: 'Sapma', en_sentence: 'This result is an aberration from the norm.', tr_sentence: 'Bu sonuç, normdan bir sapmadır.' },
                { en: 'Ephemeral', tr: 'Kısa ömürlü', en_sentence: 'Fashion is ephemeral, but style is eternal.', tr_sentence: 'Moda kısa ömürlüdür, ancak stil ebedidir.' },
                { en: 'Obfuscate', tr: 'Kafa karıştırmak', en_sentence: 'The politician tried to obfuscate the issue.', tr_sentence: 'Politikacı konuyu saptırmaya çalıştı.' },
                { en: 'Proclivity', tr: 'Eğilim', en_sentence: 'He has a proclivity for making bad decisions.', tr_sentence: 'Kötü kararlar verme eğilimi var.' },
                { en: 'Quixotic', tr: 'Hayalperest', en_sentence: 'It was a quixotic quest to find the lost city.', tr_sentence: 'Kayıp şehri bulmak hayalperest bir arayıştı.' },
                { en: 'Salient', tr: 'Belirgin', en_sentence: 'What are the salient points of your argument?', tr_sentence: 'Argümanınızın belirgin noktaları nelerdir?' },
                { en: 'Taciturn', tr: 'Sessiz', en_sentence: 'He was a taciturn man who rarely spoke.', tr_sentence: 'Nadiren konuşan sessiz bir adamdı.' },
                { en: 'Vicissitude', tr: 'Değişim', en_sentence: 'They endured the vicissitudes of life.', tr_sentence: 'Hayatın değişimlerine katlandılar.' },
                { en: 'Zephyr', tr: 'Hafif esinti', en_sentence: 'A gentle zephyr rustled the leaves.', tr_sentence: 'Hafif bir esinti yaprakları hışırdatıyordu.' },
                { en: 'Acrimony', tr: 'Sertlik', en_sentence: 'The dispute was settled without acrimony.', tr_sentence: 'Anlaşmazlık sertlik olmadan çözüldü.' },
                { en: 'Capricious', tr: 'Kaprisli', en_sentence: 'The weather is capricious in the mountains.', tr_sentence: 'Dağlarda hava kaprislidir.' },
                { en: 'Equivocate', tr: 'Kaçamaklı konuşmak', en_sentence: 'Don\'t equivocate, just give me a straight answer.', tr_sentence: 'Kaçamaklı konuşma, bana net bir cevap ver.' },
                { en: 'Fastidious', tr: 'Titiz', en_sentence: 'She is fastidious about her appearance.', tr_sentence: 'Dış görünüşü konusunda çok titizdir.' },
                { en: 'Gregarious', tr: 'Sokulgan', en_sentence: 'Dolphins are gregarious animals.', tr_sentence: 'Yunuslar sokulgan hayvanlardır.' },
                { en: 'Iconoclast', tr: 'Yerleşik değerleri yıkan', en_sentence: 'He was an iconoclast who challenged all traditions.', tr_sentence: 'Tüm geleneklere meydan okuyan, yerleşik değerleri yıkan biriydi.' },
                { en: 'Juxtaposition', tr: 'Yan yana koyma', en_sentence: 'The juxtaposition of wealth and poverty was striking.', tr_sentence: 'Zenginlik ve fakirliğin yan yana konulması çarpıcıydı.' },
                { en: 'Mellifluous', tr: 'Tatlı sesli', en_sentence: 'She has a mellifluous voice.', tr_sentence: 'Onun tatlı bir sesi var.' },
                { en: 'Perfunctory', tr: 'Üstünkörü', en_sentence: 'He gave a perfunctory nod.', tr_sentence: 'Üstünkörü bir baş sallaması verdi.' },
                { en: 'Rambunctious', tr: 'Gürültücü', en_sentence: 'The rambunctious children were hard to control.', tr_sentence: 'Gürültücü çocukları kontrol etmek zordu.' },
                { en: 'Sycophant', tr: 'Dalkavuk', en_sentence: 'The king was surrounded by sycophants.', tr_sentence: 'Kralın etrafı dalkavuklarla çevriliydi.' },
                { en: 'To bite the bullet', tr: 'Dişini sıkmak', en_sentence: 'He had to bite the bullet and accept the demotion.', tr_sentence: 'Dişini sıkmak ve tenzili rütbeyi kabul etmek zorundaydı.' },
                { en: 'Par for the course', tr: 'Beklendiği gibi', en_sentence: 'Long hours are par for the course in this job.', tr_sentence: 'Bu işte uzun saatler çalışmak beklendiği gibidir.' }
            ]
        };

        // --- KISA METİN VERİTABANI (B2/C1) ---
        const shortTexts = {
            b2: [
                { 
                    id: 'b2_text_1', 
                    text: "The rise of remote work has significantly changed urban landscapes. With fewer people commuting daily, city centers are less crowded, and local businesses in residential areas are seeing more traffic. This shift, while beneficial for work-life balance, poses challenges for commercial real estate and public transportation revenue.",
                    questions: [
                        { 
                            q: 'Metne göre, uzaktan çalışmanın toplu taşıma için oluşturduğu zorluk nedir?', 
                            type: 'mcq', 
                            options: ['Çok kalabalık olması', 'Gelir kaybı yaşaması', 'Yeterince hızlı olmaması', 'Sakin olması'], 
                            correctAnswer: 'Gelir kaybı yaşaması' 
                        }
                    ] 
                },
                { 
                    id: 'b2_text_2', 
                    text: "Fast fashion' heavily relies on rapid production cycles and low-cost materials to deliver trendy clothing quickly. However, this model is criticized for its severe environmental impact, including water pollution and massive landfill waste. Consumers are becoming more aware, leading to a slow but growing demand for sustainable alternatives.",
                    questions: [
                        { 
                            q: 'Metne göre "fast fashion" modelinin en büyük eleştiri noktası nedir?', 
                            type: 'mcq', 
                            options: ['Sürdürülebilir olması', 'Trendleri yakalaması', 'Çevresel etkisi', 'Düşük maliyeti'], 
                            correctAnswer: 'Çevresel etkisi' 
                        }
                    ] 
                }
            ],
            c1: [
                { 
                    id: 'c1_text_1', 
                    text: "Quantum entanglement, a phenomenon Einstein famously described as 'spooky action at a distance,' remains one of the most enigmatic aspects of quantum mechanics. It describes a state where two particles are linked in such a way that their fates are intertwined, regardless of the distance separating them. Measuring a property of one particle instantaneously influences the properties of the other.",
                    questions: [
                        { 
                            q: 'Einstein, "quantum entanglement" olgusunu nasıl tanımlamıştır?', 
                            type: 'mcq', 
                            options: ['Kuantum mekaniği', 'Anlık etki', 'Mesafedeki ürkütücü eylem', 'Birleşik kader'], 
                            correctAnswer: 'Mesafedeki ürkütücü eylem' 
                        }
                    ] 
                },
                { 
                    id: 'c1_text_2', 
                    text: "The concept of 'Cognitive Dissonance' suggests that individuals experience discomfort when holding two conflicting beliefs or when their actions contradict their beliefs. To alleviate this tension, people may change their actions, adjust their beliefs, or rationalize their behavior. This psychological mechanism plays a significant role in decision-making and self-perception.",
                    questions: [
                        { 
                            q: 'Metne göre, insanlar "Bilişsel Çelişki" yaşadıklarında bu gerilimi azaltmak için ne yapmazlar?', 
                            type: 'mcq', 
                            options: ['Davranışlarını rasyonelleştirmek', 'Çelişkiyi görmezden gelmek', 'İnançlarını değiştirmek', 'Eylemlerini değiştirmek'], 
                            correctAnswer: 'Çelişkiyi görmezden gelmek' 
                        }
                    ] 
                }
            ]
        };

        // --- UYGULAMA DURUMU (STATE) ---
        let state = {
            currentLevel: 'a1',
            currentWords: [],
            pinnedWords: JSON.parse(localStorage.getItem('pinnedWords') || '[]'),
            notes: JSON.parse(localStorage.getItem('notes') || '{}'),
            examHistory: JSON.parse(localStorage.getItem('examHistory') || '[]'),
            bookmarkedWordId: null, // Artık index değil, kelimenin 'en' hali
            isFrozen: false,
            quizState: 'inactive', // 'active', 'results'
            quizQuestions: [],
            currentQuestionIndex: 0,
            score: 0
        };

        // --- DOM ELEMENTLERİ ---
        const levelButtons = document.querySelectorAll('.level-btn');
        const refreshBtn = document.getElementById('refresh-btn');
        const toggleFreezeBtn = document.getElementById('toggle-freeze-btn');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const wordListContainer = document.getElementById('word-list-container');
        const loadingSpinner = document.getElementById('loading-spinner');
        
        // Quiz DOM
        const quizContainer = document.getElementById('quiz-container');
        const mainContent = document.getElementById('main-content');
        const quizProgress = document.getElementById('quiz-progress');
        const quizScore = document.getElementById('quiz-score');
        const questionArea = document.getElementById('question-area');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const quizFeedback = document.getElementById('quiz-feedback');
        const quizResults = document.getElementById('quiz-results');
        const finalScore = document.getElementById('final-score');
        const restartQuizBtn = document.getElementById('restart-quiz-btn');
        const exitQuizBtn = document.getElementById('exit-quiz-btn');
        const requestExitQuizBtn = document.getElementById('request-exit-quiz-btn');

        // Modal DOM
        const pinnedModal = document.getElementById('pinned-modal');
        const pinnedListBtn = document.getElementById('pinned-list-btn');
        const closePinnedModalBtn = document.getElementById('close-pinned-modal-btn');
        const pinnedListContent = document.getElementById('pinned-list-content');

        // Sınav Geçmişi Modalı DOM
        const examHistoryModal = document.getElementById('exam-history-modal');
        const examHistoryBtn = document.getElementById('exam-history-btn');
        const closeExamHistoryModalBtn = document.getElementById('close-exam-history-modal-btn');
        const examHistoryContent = document.getElementById('exam-history-content');
        const clearExamHistoryBtn = document.getElementById('clear-exam-history-btn');

        // Arama Modalı DOM
        const searchResultsModal = document.getElementById('search-results-modal');
        const searchBar = document.getElementById('search-bar');
        const searchBtn = document.getElementById('search-btn');
        const mobileSearchBar = document.getElementById('mobile-search-bar');
        const mobileSearchBtn = document.getElementById('mobile-search-btn');
        const closeSearchResultsModalBtn = document.getElementById('close-search-results-modal-btn');
        const searchResultsContent = document.getElementById('search-results-content');

        // Sınav Çıkış Modalı DOM
        const exitQuizModal = document.getElementById('exit-quiz-modal');
        const confirmExitQuizBtn = document.getElementById('confirm-exit-quiz-btn');
        const cancelExitQuizBtn = document.getElementById('cancel-exit-quiz-btn');

        // Message Box DOM
        const appMessage = document.getElementById('app-message');
        const appMessageText = document.getElementById('app-message-text');

        // --- FONKSİYONLAR ---

        /**
         * Kelimeleri karıştırmak için (Fisher-Yates Shuffle)
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        /**
         * Özel uygulama mesajı gösterir
         */
        function showAppMessage(message, type = 'error') {
            appMessageText.textContent = message;
            appMessage.classList.remove('bg-red-600', 'bg-green-600', 'bg-blue-600', 'bg-purple-600');
            
            if (type === 'error') {
                appMessage.classList.add('bg-red-600');
            } else if (type === 'success') {
                appMessage.classList.add('bg-green-600');
            } else {
                appMessage.classList.add('bg-purple-600');
            }

            appMessage.classList.remove('hidden', 'translate-y-20', 'opacity-0');
            appMessage.classList.add('translate-y-0', 'opacity-100');

            setTimeout(() => {
                appMessage.classList.remove('translate-y-0', 'opacity-100');
                appMessage.classList.add('translate-y-20', 'opacity-0');
                setTimeout(() => appMessage.classList.add('hidden'), 300);
            }, 3000);
        }

        /**
         * Seçilen seviyeye göre 50 kelime getirir
         */
        function fetchWords() {
            if (state.isFrozen) {
                showAppMessage('Liste sabitlenmiş. Yenilemek için sabitlemeyi kaldırın.', 'info');
                return;
            }

            wordListContainer.innerHTML = '';
            loadingSpinner.classList.remove('hidden');
            startQuizBtn.disabled = true;

            // Simüle edilmiş yükleme süresi
            setTimeout(() => {
                const words = wordBank[state.currentLevel];
                if (!words || words.length === 0) {
                    wordListContainer.innerHTML = '<p class="text-gray-400 col-span-full text-center">Bu seviye için kelime bulunamadı.</p>';
                    loadingSpinner.classList.add('hidden');
                    return;
                }

                const shuffledWords = shuffleArray([...words]);
                state.currentWords = shuffledWords.slice(0, 50);
                
                renderWords();
                loadingSpinner.classList.add('hidden');
                
                // Sınav butonunu, 15 soru oluşturulabiliyorsa aktifleştir
                if (state.currentWords.length >= 15) {
                    startQuizBtn.disabled = false;
                } else {
                    startQuizBtn.disabled = true;
                    showAppMessage('Sınav için bu seviyede yeterli kelime (en az 15) bulunmuyor.', 'error');
                }
            }, 500); // 0.5 saniye gecikme
        }

        /**
         * currentWords dizisindeki kelimeleri ekrana basar
         */
        function renderWords() {
            wordListContainer.innerHTML = '';
            
            if (state.currentWords.length === 0) {
                wordListContainer.innerHTML = '<p class="text-gray-400 col-span-full text-center">Gösterilecek kelime yok. Lütfen seviye seçin ve "Yeni Kelimeler" butonuna basın.</p>';
                return;
            }

            state.currentWords.forEach((word) => {
                const isPinned = state.pinnedWords.some(p => p.en === word.en);
                const note = state.notes[word.en] || '';
                const isBookmarked = state.bookmarkedWordId === word.en;

                const card = document.createElement('div');
                card.className = `word-card bg-gray-800 p-4 rounded-lg shadow-md transition-all duration-300 ${isBookmarked ? 'bookmark-highlight' : ''}`;
                card.dataset.enWord = word.en;

                card.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="text-xl font-bold text-gray-100">${word.en}</h3>
                        <div class="flex space-x-2">
                            <button class="bookmark-btn p-2 rounded-full hover:bg-yellow-100" title="Yer İşareti Koy">
                                <svg class="w-5 h-5 ${isBookmarked ? 'text-yellow-500 fill-current' : 'text-gray-500'}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-3.125L5 18V4z" />
                                </svg>
                            </button>
                            <button class="pin-btn p-2 rounded-full hover:bg-purple-100" title="Sabitle">
                                <svg class="w-5 h-5 ${isPinned ? 'text-purple-400' : 'text-gray-500'}" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 10-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <p class="text-lg text-gray-300 mb-3">${word.tr}</p>
                    <textarea class="note-input w-full p-2 border bg-gray-700 border-gray-600 rounded-md text-sm text-gray-200 focus:ring-2 focus:ring-purple-500 focus:border-transparent" rows="2" placeholder="Kişisel notunuzu buraya yazın... (Örn: 'naber' gibi kullanılır)">${note}</textarea>
                `;

                // Event Listeners
                card.querySelector('.pin-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    togglePin(word);
                });
                card.querySelector('.bookmark-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleBookmark(word.en);
                });
                card.querySelector('.note-input').addEventListener('change', (e) => {
                    saveNote(word.en, e.target.value);
                });

                wordListContainer.appendChild(card);
            });
        }

        /**
         * Bir kelimeyi sabitler veya sabitlemesini kaldırır
         */
        function togglePin(word) {
            const index = state.pinnedWords.findIndex(p => p.en === word.en);
            const card = wordListContainer.querySelector(`.word-card[data-en-word="${word.en}"]`);
            const pinIcon = card ? card.querySelector('.pin-btn svg') : null;

            if (index > -1) {
                // Pin kaldır
                state.pinnedWords.splice(index, 1);
                if(pinIcon) pinIcon.classList.remove('text-purple-400');
                if(pinIcon) pinIcon.classList.add('text-gray-500');
                showAppMessage(`"${word.en}" sabitlemesi kaldırıldı.`, 'info');
            } else {
                // Pinle
                state.pinnedWords.push(word);
                if(pinIcon) pinIcon.classList.add('text-purple-400');
                if(pinIcon) pinIcon.classList.remove('text-gray-500');
                showAppMessage(`"${word.en}" sabitlendi.`, 'success');
            }
            localStorage.setItem('pinnedWords', JSON.stringify(state.pinnedWords));
        }

        /**
         * Bir kelimeye yer işareti koyar
         */
        function toggleBookmark(enWord) {
            const oldBookmarkedCard = document.querySelector('.bookmark-highlight');
            if (oldBookmarkedCard) {
                oldBookmarkedCard.classList.remove('bookmark-highlight');
                oldBookmarkedCard.querySelector('.bookmark-btn svg').classList.remove('text-yellow-500', 'fill-current');
                oldBookmarkedCard.querySelector('.bookmark-btn svg').classList.add('text-gray-500');
            }

            if (state.bookmarkedWordId === enWord) {
                // İşareti kaldır
                state.bookmarkedWordId = null;
            } else {
                // Yeni işaret koy
                state.bookmarkedWordId = enWord;
                const newBookmarkedCard = wordListContainer.querySelector(`.word-card[data-en-word="${enWord}"]`);
                if (newBookmarkedCard) {
                    newBookmarkedCard.classList.add('bookmark-highlight');
                    const icon = newBookmarkedCard.querySelector('.bookmark-btn svg');
                    icon.classList.add('text-yellow-500', 'fill-current');
                    icon.classList.remove('text-gray-500');
                    
                    // Karta odaklan (kaydır)
                    newBookmarkedCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }

        /**
         * Notu kaydeder
         */
        function saveNote(enWord, noteText) {
            if (noteText.trim() === '') {
                delete state.notes[enWord];
            } else {
                state.notes[enWord] = noteText.trim();
            }
            localStorage.setItem('notes', JSON.stringify(state.notes));
            showAppMessage(`"${enWord}" için not kaydedildi.`, 'success');
        }

        /**
         * Seviye değiştirme
         */
        function handleLevelChange(e) {
            if (state.quizState === 'active') {
                handleExitQuizRequest();
                return;
            }
            
            const newLevel = e.target.dataset.level;
            if (!newLevel || newLevel === state.currentLevel) return;

            state.currentLevel = newLevel;
            state.isFrozen = false; // Seviye değişince sabitleme kalkar
            state.bookmarkedWordId = null;
            toggleFreezeBtn.textContent = 'Listeyi Sabitle';
            toggleFreezeBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
            toggleFreezeBtn.classList.add('bg-green-600', 'hover:bg-green-700');

            // Aktif buton stilini güncelle
            document.querySelectorAll('.level-btn').forEach(btn => {
                if (btn.dataset.level === newLevel) {
                    btn.classList.add('bg-purple-600', 'text-white');
                    btn.classList.remove('text-gray-300', 'hover:bg-gray-700');
                } else {
                    btn.classList.remove('bg-purple-600', 'text-white');
                    btn.classList.add('text-gray-300', 'hover:bg-gray-700');
                }
            });

            fetchWords();
        }

        /**
         * Liste sabitlemeyi aç/kapat
         */
        function toggleFreeze() {
            state.isFrozen = !state.isFrozen;
            if (state.isFrozen) {
                toggleFreezeBtn.textContent = 'Sabitlemeyi Kaldır';
                toggleFreezeBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                toggleFreezeBtn.classList.add('bg-red-600', 'hover:bg-red-700');
                showAppMessage('Liste sabitlendi. Kelimeler değişmeyecek.', 'info');
            } else {
                toggleFreezeBtn.textContent = 'Listeyi Sabitle';
                toggleFreezeBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
                toggleFreezeBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                showAppMessage('Sabitleme kaldırıldı.', 'info');
            }
        }

        /**
         * Sabitlenen kelimeler modalını göster
         */
        function showPinnedWordsModal() {
            pinnedListContent.innerHTML = '';
            if (state.pinnedWords.length === 0) {
                pinnedListContent.innerHTML = '<p class="text-gray-400 text-center">Henüz sabitlenmiş kelimeniz yok.</p>';
            } else {
                state.pinnedWords.sort((a, b) => a.en.localeCompare(b.en)).forEach(word => {
                    const note = state.notes[word.en] || '<i>Not eklenmemiş</i>';
                    const item = document.createElement('div');
                    item.className = 'py-4 border-b border-gray-700 last:border-b-0';
                    
                    if (word.isTranslation) {
                        item.innerHTML = `
                            <div class="flex justify-between items-center">
                                <h4 class="text-xl font-semibold text-purple-400">Çeviri</h4>
                                <span class="text-lg text-gray-200">(Sabitlendi)</span>
                            </div>
                            <p class="text-gray-300 mt-2"><strong>Orijinal:</strong> ${word.en}</p>
                            <p class="text-gray-300 mt-1"><strong>Çeviri:</strong> ${word.tr}</p>
                        `;
                    } else {
                        item.innerHTML = `
                            <div class="flex justify-between items-center">
                                <h4 class="text-xl font-semibold text-purple-400">${word.en}</h4>
                                <span class="text-lg text-gray-200">${word.tr}</span>
                            </div>
                            <p class="text-gray-300 mt-2"><strong>Not:</strong> ${note}</p>
                        `;
                    }
                    pinnedListContent.appendChild(item);
                });
            }
            pinnedModal.classList.remove('hidden');
        }

        /**
         * Sınav geçmişi modalını göster
         */
        function showExamHistoryModal() {
            examHistoryContent.innerHTML = '';
            if (state.examHistory.length === 0) {
                examHistoryContent.innerHTML = '<p class="text-gray-400 text-center">Henüz tamamlanmış bir sınavınız yok.</p>';
            } else {
                // En yeniden eskiye sırala
                state.examHistory.slice().reverse().forEach(result => {
                    const date = new Date(result.date).toLocaleString('tr-TR');
                    const item = document.createElement('div');
                    item.className = 'py-4 border-b border-gray-700 last:border-b-0';
                    item.innerHTML = `
                        <div class="flex justify-between items-center">
                            <h4 class="text-xl font-semibold text-purple-400">${result.level.toUpperCase()} Seviyesi</h4>
                            <span class="text-lg font-bold ${result.score > (result.total / 2) ? 'text-green-400' : 'text-red-400'}">
                                ${result.score} / ${result.total}
                            </span>
                        </div>
                        <p class="text-gray-400 mt-1 text-sm">${date}</p>
                    `;
                    examHistoryContent.appendChild(item);
                });
            }
            examHistoryModal.classList.remove('hidden');
        }

        /**
         * Sınav geçmişini temizler
         */
        function clearExamHistory() {
            state.examHistory = [];
            localStorage.removeItem('examHistory');
            showExamHistoryModal();
            showAppMessage('Sınav geçmişi temizlendi.', 'info');
        }

        /**
         * Sınav sonucunu kaydeder
         */
        function saveExamResult() {
            const result = {
                level: state.currentLevel,
                score: state.score,
                total: 15,
                date: new Date().toISOString()
            };
            state.examHistory.push(result);
            localStorage.setItem('examHistory', JSON.stringify(state.examHistory));
        }


        // --- ARAMA FONKSİYONLARI ---

        /**
         * Arama çubuğunu yönetir: Kelime arar veya cümle çevirir
         */
        function handleSearchOrTranslate(e) {
            const isMobile = e.currentTarget.id === 'mobile-search-btn' || e.currentTarget.id === 'mobile-search-bar';
            const searchTerm = (isMobile ? mobileSearchBar.value : searchBar.value).trim();

            if (searchTerm.length < 2) {
                showAppMessage('Arama veya çeviri için en az 2 karakter girmelisiniz.', 'error');
                return;
            }

            // Arama mı, çeviri mi? (Basit bir boşluk sayımı)
            const isSentence = searchTerm.split(' ').length >= 2;

            if (isSentence) {
                translateText(searchTerm);
            } else {
                searchLocalWords(searchTerm.toLowerCase());
            }
        }

        /**
         * Veritabanında kelime arar ve sonuçları gösterir
         */
        function searchLocalWords(searchTerm) {
            const allWords = Object.values(wordBank).flat();
            const results = allWords.filter(word => 
                word.en.toLowerCase().includes(searchTerm) || 
                word.tr.toLowerCase().includes(searchTerm)
            );

            searchResultsContent.innerHTML = '';
            if (results.length === 0) {
                searchResultsContent.innerHTML = '<p class="text-gray-400 text-center">Aramanızla eşleşen kelime bulunamadı.</p>';
            } else {
                results.forEach(word => {
                    const note = state.notes[word.en] || '<i>Not eklenmemiş</i>';
                    const isPinned = state.pinnedWords.some(p => p.en === word.en);
                    const item = document.createElement('div');
                    item.className = 'py-4 border-b border-gray-700 last:border-b-0';
                    item.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="text-xl font-semibold text-purple-400">${word.en}</h4>
                                <span class="text-lg text-gray-200">${word.tr}</span>
                            </div>
                            <button class="search-pin-btn p-2 rounded-full hover:bg-purple-100" data-en-word='${JSON.stringify(word)}' title="Sabitle">
                                <svg class="w-6 h-6 ${isPinned ? 'text-purple-400' : 'text-gray-500'}" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 10-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                                </svg>
                            </button>
                        </div>
                        <p class="text-gray-400 mt-2 text-sm"><strong>Cümle:</strong> ${word.en_sentence}</p>
                        <p class="text-gray-400 mt-1 text-sm"><strong>Çeviri:</strong> ${word.tr_sentence}</p>
                    `;
                    searchResultsContent.appendChild(item);
                });

                // Arama sonucu sabitleme butonlarına event listener ekle
                searchResultsContent.querySelectorAll('.search-pin-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const wordData = JSON.parse(btn.dataset.enWord);
                        togglePin(wordData);
                        // İkonu anında güncelle
                        const icon = btn.querySelector('svg');
                        const isPinnedNow = state.pinnedWords.some(p => p.en === wordData.en);
                        if (isPinnedNow) {
                            icon.classList.add('text-purple-400');
                            icon.classList.remove('text-gray-500');
                        } else {
                            icon.classList.remove('text-purple-400');
                            icon.classList.add('text-gray-500');
                        }
                    });
                });
            }
            searchResultsModal.classList.remove('hidden');
        }

        /**
         * Gemini API kullanarak metni çevirir
         */
        async function translateText(text) {
            searchResultsContent.innerHTML = `
                <div class="text-center py-10">
                    <svg class="animate-spin h-8 w-8 text-purple-400 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="mt-2 text-gray-400 font-medium">Yapay zeka ile çevriliyor...</p>
                </div>`;
            searchResultsModal.classList.remove('hidden');

            const apiKey = ""; // API Anahtarınız buraya gelecek
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            const systemPrompt = "You are a translator. Detect the language of the provided text (it will be either Turkish or English) and translate it into the other language. Respond ONLY with the translated text, nothing else.";

            const payload = {
                contents: [{ parts: [{ text: text }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API hatası: ${response.statusText}`);
                }

                const result = await response.json();
                const translatedText = result.candidates[0].content.parts[0].text.trim();

                const translationObject = {
                    en: text, // Orijinal metin
                    tr: translatedText, // Çevrilen metin
                    isTranslation: true
                };

                const isPinned = state.pinnedWords.some(p => p.en === translationObject.en);

                searchResultsContent.innerHTML = `
                    <div class="py-4">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-xl font-semibold text-purple-400">Çeviri Sonucu</h4>
                             <button id="pin-translation-btn" class="p-2 rounded-full hover:bg-purple-100" title="Bu çeviriyi sabitle">
                                <svg class="w-6 h-6 ${isPinned ? 'text-purple-400' : 'text-gray-500'}" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 10-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="bg-gray-700 p-4 rounded-lg">
                            <p class="text-gray-400 mb-2 font-medium">Orijinal Metin:</p>
                            <p class="text-gray-200 text-lg mb-4">${text}</p>
                            <p class="text-gray-400 mb-2 font-medium">Çeviri:</p>
                            <p class="text-purple-300 text-lg font-semibold">${translatedText}</p>
                        </div>
                    </div>
                `;

                // Çeviriyi pinleme butonu
                document.getElementById('pin-translation-btn').addEventListener('click', (e) => {
                    togglePin(translationObject);
                    const icon = e.currentTarget.querySelector('svg');
                    const isPinnedNow = state.pinnedWords.some(p => p.en === translationObject.en);
                    if (isPinnedNow) {
                        icon.classList.add('text-purple-400');
                        icon.classList.remove('text-gray-500');
                    } else {
                        icon.classList.remove('text-purple-400');
                        icon.classList.add('text-gray-500');
                    }
                });

            } catch (error) {
                console.error('Çeviri hatası:', error);
                searchResultsContent.innerHTML = `<p class="text-red-400 text-center">Çeviri sırasında bir hata oluştu. Lütfen tekrar deneyin. (Hata: ${error.message})</p>`;
            }
        }


        // --- SINAV FONKSİYONLARI ---

        /**
         * Sınavı başlatır
         */
        function startQuiz() {
            if (state.currentWords.length < 15) {
                showAppMessage('Sınavı başlatmak için yeterli kelime (en az 15) yok.', 'error');
                return;
            }
            state.score = 0;
            state.currentQuestionIndex = 0;
            state.quizState = 'active';

            mainContent.classList.add('hidden');
            quizContainer.classList.remove('hidden');
            quizResults.classList.add('hidden');
            questionArea.classList.remove('hidden');

            quizScore.textContent = `Puan: 0`;
            quizProgress.textContent = `Soru 1 / 15`;
            
            generateQuizQuestions();
            displayQuestion();
        }

        /**
         * Sınav için 15 soru oluşturur
         */
        function generateQuizQuestions() {
            state.quizQuestions = [];
            const words = shuffleArray([...state.currentWords]);
            let usedWords = new Set();
            
            // 6 Soru: EN -> TR (MCQ)
            for (let i = 0; i < 6; i++) {
                const questionWord = words[i];
                usedWords.add(questionWord.en);
                
                let options = [questionWord.tr];
                while (options.length < 4) {
                    const randomWord = words[Math.floor(Math.random() * words.length)];
                    if (!options.includes(randomWord.tr)) {
                        options.push(randomWord.tr);
                    }
                }
                
                state.quizQuestions.push({
                    type: 'mcq',
                    question: `"${questionWord.en}" kelimesinin Türkçe anlamı nedir?`,
                    options: shuffleArray(options),
                    correctAnswer: questionWord.tr
                });
            }
            
            // 6 Soru: TR -> EN (MCQ)
            for (let i = 6; i < 12; i++) {
                const questionWord = words[i];
                usedWords.add(questionWord.en);
                
                let options = [questionWord.en];
                while (options.length < 4) {
                    const randomWord = words[Math.floor(Math.random() * words.length)];
                    if (!options.includes(randomWord.en)) {
                        options.push(randomWord.en);
                    }
                }
                
                state.quizQuestions.push({
                    type: 'mcq',
                    question: `"${questionWord.tr}" kelimesinin İngilizce anlamı nedir?`,
                    options: shuffleArray(options),
                    correctAnswer: questionWord.en
                });
            }

            // 3 Soru: TR -> EN (Input)
            for (let i = 12; i < 15; i++) {
                 const questionWord = words[i];
                 usedWords.add(questionWord.en);

                 state.quizQuestions.push({
                    type: 'input',
                    question: `"${questionWord.tr}" kelimesinin İngilizce karşılığını yazınız.`,
                    correctAnswer: questionWord.en
                });
            }

            // B2 ve C1 seviyelerinde 2 soruyu metin okuma ile değiştir
            if (state.currentLevel === 'b2' || state.currentLevel === 'c1') {
                const texts = shuffleArray([...shortTexts[state.currentLevel]]);
                
                // İlk soruyu değiştir
                const text1 = texts[0];
                const q1 = text1.questions[0];
                state.quizQuestions[0] = {
                    type: 'reading_mcq',
                    text: text1.text,
                    question: q1.q,
                    options: shuffleArray(q1.options),
                    correctAnswer: q1.correctAnswer
                };
                
                // İkinci soruyu değiştir
                const text2 = texts[1];
                const q2 = text2.questions[0];
                state.quizQuestions[1] = {
                    type: 'reading_mcq',
                    text: text2.text,
                    question: q2.q,
                    options: shuffleArray(q2.options),
                    correctAnswer: q2.correctAnswer
                };
            }
            
            state.quizQuestions = shuffleArray(state.quizQuestions);
        }

        /**
         * Mevcut soruyu ekranda gösterir
         */
        function displayQuestion() {
            const q = state.quizQuestions[state.currentQuestionIndex];
            quizFeedback.classList.add('hidden');
            optionsContainer.innerHTML = '';
            
            if (q.type === 'reading_mcq') {
                questionText.innerHTML = `
                    <p class="text-sm text-gray-400 mb-4 bg-gray-700 p-3 rounded-md italic">${q.text}</p>
                    <p class="text-xl text-gray-200 font-medium">${q.question}</p>
                `;
            } else {
                questionText.textContent = q.question;
            }

            if (q.type === 'mcq' || q.type === 'reading_mcq') {
                q.options.forEach(option => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.className = 'quiz-option';
                    button.addEventListener('click', () => checkAnswer(option));
                    optionsContainer.appendChild(button);
                });
            } else if (q.type === 'input') {
                optionsContainer.innerHTML = `
                    <input type="text" id="quiz-input" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:outline-none" placeholder="Cevabınızı buraya yazın...">
                    <button id="quiz-submit-btn" class="w-full mt-3 bg-purple-600 text-white px-5 py-3 rounded-lg font-semibold hover:bg-purple-700 transition">
                        Kontrol Et
                    </button>
                `;
                document.getElementById('quiz-submit-btn').addEventListener('click', () => {
                    const input = document.getElementById('quiz-input').value;
                    checkAnswer(input);
                });
                 document.getElementById('quiz-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        checkAnswer(e.target.value);
                    }
                });
            }
            
            quizProgress.textContent = `Soru ${state.currentQuestionIndex + 1} / 15`;
        }

        /**
         * Verilen cevabı kontrol eder
         */
        function checkAnswer(selectedAnswer) {
            const q = state.quizQuestions[state.currentQuestionIndex];
            const isCorrect = selectedAnswer.trim().toLowerCase() === q.correctAnswer.toLowerCase();

            quizFeedback.classList.remove('hidden', 'text-green-400', 'text-red-400');
            
            // Tüm seçenekleri ve inputları devre dışı bırak
            optionsContainer.querySelectorAll('button, input').forEach(el => el.disabled = true);

            if (q.type === 'mcq' || q.type === 'reading_mcq') {
                 optionsContainer.querySelectorAll('button').forEach(btn => {
                     if (btn.textContent === q.correctAnswer) {
                         btn.classList.add('correct');
                     } else if (btn.textContent === selectedAnswer && !isCorrect) {
                         btn.classList.add('incorrect');
                     }
                 });
            }

            if (isCorrect) {
                state.score++;
                quizScore.textContent = `Puan: ${state.score}`;
                quizFeedback.textContent = "Doğru!";
                quizFeedback.classList.add('text-green-400');
            } else {
                quizFeedback.textContent = `Yanlış. Doğru cevap: ${q.correctAnswer}`;
                quizFeedback.classList.add('text-red-400');
                 if (q.type === 'input') {
                    document.getElementById('quiz-input').classList.add('border-red-500');
                }
            }

            setTimeout(nextQuestion, 1500);
        }

        /**
         * Sonraki soruya geçer veya sınavı bitirir
         */
        function nextQuestion() {
            state.currentQuestionIndex++;
            if (state.currentQuestionIndex < 15) {
                displayQuestion();
            } else {
                showQuizResults();
            }
        }

        /**
         * Sınav sonuç ekranını gösterir
         */
        function showQuizResults() {
            state.quizState = 'results';
            questionArea.classList.add('hidden');
            quizResults.classList.remove('hidden');
            finalScore.textContent = state.score;
            saveExamResult();
        }

        /**
         * Sınavı bitirir ve ana ekrana döner
         */
        function exitQuiz() {
            state.quizState = 'inactive';
            quizContainer.classList.add('hidden');
            mainContent.classList.remove('hidden');
            state.score = 0;
            state.currentQuestionIndex = 0;
        }

        /**
         * Sınavı yeniden başlatır
         */
        function restartQuiz() {
            startQuiz();
        }

        /**
         * Sınavdan çıkış modalını gösterir
         */
        function handleExitQuizRequest() {
            exitQuizModal.classList.remove('hidden');
        }

        /**
         * Sınavdan çıkışı onaylar
         */
        function confirmExitQuiz() {
            exitQuizModal.classList.add('hidden');
            exitQuiz();
        }

        /**
         * Sınavdan çıkışı iptal eder
         */
        function cancelExitQuiz() {
            exitQuizModal.classList.add('hidden');
        }


        // --- EVENT LISTENERS ---
        document.addEventListener('DOMContentLoaded', () => {
            // Ana Butonlar
            levelButtons.forEach(btn => btn.addEventListener('click', handleLevelChange));
            refreshBtn.addEventListener('click', () => {
                if (state.quizState === 'active') {
                    handleExitQuizRequest();
                } else {
                    fetchWords();
                }
            });
            toggleFreezeBtn.addEventListener('click', toggleFreeze);
            startQuizBtn.addEventListener('click', startQuiz);

            // Modal Butonları
            pinnedListBtn.addEventListener('click', showPinnedWordsModal);
            closePinnedModalBtn.addEventListener('click', () => pinnedModal.classList.add('hidden'));

            examHistoryBtn.addEventListener('click', showExamHistoryModal);
            closeExamHistoryModalBtn.addEventListener('click', () => examHistoryModal.classList.add('hidden'));
            clearExamHistoryBtn.addEventListener('click', clearExamHistory);

            closeSearchResultsModalBtn.addEventListener('click', () => searchResultsModal.classList.add('hidden'));

            // Arama Butonları
            searchBtn.addEventListener('click', handleSearchOrTranslate);
            searchBar.addEventListener('keypress', (e) => e.key === 'Enter' && handleSearchOrTranslate(e));
            mobileSearchBtn.addEventListener('click', handleSearchOrTranslate);
            mobileSearchBar.addEventListener('keypress', (e) => e.key === 'Enter' && handleSearchOrTranslate(e));
            
            // Sınav Kontrol Butonları
            restartQuizBtn.addEventListener('click', restartQuiz);
            exitQuizBtn.addEventListener('click', exitQuiz);
            requestExitQuizBtn.addEventListener('click', handleExitQuizRequest);

            // Sınav Çıkış Modalı Butonları
            confirmExitQuizBtn.addEventListener('click', confirmExitQuiz);
            cancelExitQuizBtn.addEventListener('click', cancelExitQuiz);

            // İlk kelimeleri yükle
            fetchWords();
        });

    </script>
</body>
</html>
